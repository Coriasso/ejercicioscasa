<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Rss Coriasso</title>
<script
	src="https://code.jquery.com/jquery-3.3.1.min.js"
	integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous">
</script>

<script>
	
   

//Tengo en la variable datos_rss las noticias
//Esto es una spa ( Single Page Application), cargamos la l√≥gica de la APP con document.ready

$(document).ready(
    function(){
      
        //https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20rss%20where%20url%3D'http%3A%2F%2Fwww.ideal.es%2Frss%2F'&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys

        $('#boton_cargar_rss').on('click', function(){
            let html = 'Cargando datos...';
            let consulta = '';
            consulta += 'https://query.yahooapis.com/v1/public/yql?q=';
            consulta += "select * from rss where url='" + $('#input_url').val() + "'&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";
            consulta = encodeURI(consulta);
            $("#lector").html(html);

            $.ajax({
                url:consulta,
                success:function(datos){
                console.log(datos);
				if (datos.query.count != 0){
				
					 let tabla='';
					 tabla += '<h4>Hay ' +datos.query.count + ' noticias</h4>';
					 $("#lector").html(html);
                 
					tabla+='<table border="1px">';
						for(let i=0; i<datos.query.count; i++){
							tabla+='<tr>';
							tabla+='<td>' + datos.query.results.item[i].date +'</td>';
							tabla+='<td> <a href="'+ datos.query.results.item[i].guid +'target="_blank">'+ datos.query.results.item[i].title+ '</a></td>';
							tabla+='<td>'+datos.query.results.item[i].description+'</td>';
							tabla+='</tr>';
						}    
					tabla+='</table>'
					$("#lector").html(tabla);
				}
				else{
					let consulta = '';
					consulta += 'https://query.yahooapis.com/v1/public/yql?q=';
					consulta += "select * from atom where url='" + $('#input_url').val() + "'&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";
					consulta = encodeURI(consulta);
					$("#lector").html(consulta);

					$.ajax({
						url:consulta,
						success:function(datos){
						console.log (datos);
					    let tabla = '';
					    tabla += '<h4>Hay ' + datos.query.count + ' noticias </h4>'
					    $('#lector').html(tabla);
					    tabla +='<table border=1px>';
					    for (let i= 0; i < datos.query.count;i++) {
							tabla+='<tr>';
							tabla+='<td>' + datos.query.results.entry[i].id +'</td>';
							tabla+='<td> <a href="'+ datos.query.results.entry[i].link +'target="_blank">'+ datos.query.results.entry[i].title+ '</a></td>';
							tabla+='<td>'+datos.query.results.entry[i].summary.content+'</td>';
							tabla+='<td>'+datos.query.results.entry[i].updated+'</td>'
							tabla+='</tr>';
					     }
					 tabla+='</table>'
					$("#lector").html(tabla);
             }
            })
				}
				

                }
            })
           
           
        });

//https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20atom%20where%20url%3D'http%3A%2F%2Frss.slashdot.org%2FSlashdot%2FslashdotMainatom'&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys

        $('#boton_cargar_atom').on('click', function(){
            let html = 'Cargando datos...';
            let consulta = '';
            consulta += 'https://query.yahooapis.com/v1/public/yql?q=';
            consulta += "select * from atom where url='" + $('#input_url').val() + "'&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";
            consulta = encodeURI(consulta);
            $("#lector").html(consulta);

            $.ajax({
                url:consulta,
                success:function(datos){
               console.log (datos);
               let tabla = '';
               tabla += '<h4>Hay ' + datos.query.count + ' noticias </h4>'
               $('#lector').html(tabla);
               tabla +='<table border=1px>';
               for (let i= 0; i < datos.query.count;i++) {
                    tabla+='<tr>';
                    tabla+='<td>' + datos.query.results.entry[i].id +'</td>';
                    tabla+='<td> <a href="'+ datos.query.results.entry[i].link +'target="_blank">'+ datos.query.results.entry[i].title+ '</a></td>';
                    tabla+='<td>'+datos.query.results.entry[i].summary.content+'</td>';
                    tabla+='<td>'+datos.query.results.entry[i].updated+'</td>'
                    tabla+='</tr>';
                 }
                 tabla+='</table>'
                $("#lector").html(tabla);
             }
            })
           
           
        });


       
    }
    
)


</script>

<meta name="generator" content="Geany 1.27" />
</head>

<body>

    <h1>Noticias</h1>

    <div>
        
        <input type="url" id="input_url"/>
        <button id="boton_cargar_rss">Leer rss</button>
        <button id="boton_cargar_atom">Leer atom</button>
      
    </div>
    
    <div id="lector">

    </div>
</body>

</html>
